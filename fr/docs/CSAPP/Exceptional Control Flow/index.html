<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-CSAPP/Exceptional Control Flow">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<title data-rh="true">Flux de contrôle exceptionnel | My resume</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://malaaa.mljlls.tech//fr/docs/CSAPP/Exceptional Control Flow"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Flux de contrôle exceptionnel | My resume"><meta data-rh="true" name="description" content="Les exceptions sont une forme de flux de contrôle exceptionnel qui sont mis en œuvre en partie par le matériel eten partie par le système d&#x27;exploitation. \ Une exception est un changement brusque dans le flux de contrôle en réponse à un certain changement dans l&#x27;état du processeur."><meta data-rh="true" property="og:description" content="Les exceptions sont une forme de flux de contrôle exceptionnel qui sont mis en œuvre en partie par le matériel eten partie par le système d&#x27;exploitation. \ Une exception est un changement brusque dans le flux de contrôle en réponse à un certain changement dans l&#x27;état du processeur."><link data-rh="true" rel="icon" href="/fr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://malaaa.mljlls.tech//fr/docs/CSAPP/Exceptional Control Flow"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//docs/CSAPP/Exceptional Control Flow" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//fr/docs/CSAPP/Exceptional Control Flow" hreflang="fr"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//zh-CN/docs/CSAPP/Exceptional Control Flow" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://malaaa.mljlls.tech//docs/CSAPP/Exceptional Control Flow" hreflang="x-default"><link rel="stylesheet" href="/fr/assets/css/styles.cde37931.css">
<link rel="preload" href="/fr/assets/js/runtime~main.141affde.js" as="script">
<link rel="preload" href="/fr/assets/js/main.f9e7bdf0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Passer au contenu principal</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fr/"><div class="navbar__logo"><img src="/fr/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/fr/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Mon CV</b></a><a class="navbar__item navbar__link navbar__link--active" href="/fr/docs/intro">Mes notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Malaaaa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/docs/CSAPP/Exceptional Control Flow" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/fr/docs/CSAPP/Exceptional Control Flow" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">Français</a></li><li><a href="/zh-CN/docs/CSAPP/Exceptional Control Flow" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（中国）</a></li></ul></div><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Basculer entre les modes sombre et clair (actuellement mode lumière)" aria-label="Basculer entre les modes sombre et clair (actuellement mode lumière)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Faites défiler vers le haut" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/Flutter/">Apprentissage flottant</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Apprentissage flottant&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/ReadingNote">Livres</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/fr/docs/CSAPP/CSAPPNOTE">CSAPP</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/CSAPPNOTE">Systèmes informatiques</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fr/docs/CSAPP/Exceptional Control Flow">Flux de contrôle exceptionnel</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/fr/docs/CSAPP/I/O">je</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/Linking">Linking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fr/docs/CSAPP/Network">Network</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/HomeChain">HomeChain</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/JavaScript/">Exemple Javascript utile</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Exemple Javascript utile&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/Linux/WSL/LAMP">Linux</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/LinuxConfigNote">Noter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/NetworkBS">Réseau informatique de base</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/fr/docs/Nodejs/">Architecture</a><button aria-label="Basculer la catégorie de la barre latérale réductible &#x27;Architecture&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/React/HookUse">Réagir</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/Skill/IDE">Compétence</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/fr/docs/TypeScript/Generics">TypeScript</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/Web-Note">Web notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fr/docs/docsify">documenter</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/fr/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CSAPP</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Flux de contrôle exceptionnel</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">Sur cette page</button></div><div class="theme-doc-markdown markdown"><h1>Flux de contrôle exceptionnel</h1><p>Les exceptions sont une forme de flux de contrôle exceptionnel qui sont mis en œuvre en partie par le matériel*<strong>* et</strong>en partie par le système d&#x27;exploitation.** \ Une exception est un changement brusque dans le flux de contrôle en réponse à un certain changement dans l&#x27;état du processeur.</p><p>Les exceptions asynchrones sont générées par des événements dans les périphériques d&#x27;E/S externes au processeur. Les exceptions synchrones sont le produit direct de l&#x27;exécution d&#x27;une instruction.</p><p><img loading="lazy" alt="Anatomie d&amp;#39;une exception" src="/fr/assets/images/img_11-a6b1ee91d133ea85c07ca53796d56865.png" width="924" height="492" class="img_E7b_"> Lorsque le système d&#x27;exploitation démarre, une table de sauts appelée table d&#x27;exceptions est allouée et initialisée.</p><p><img loading="lazy" alt="img_12.png" src="/fr/assets/images/img_12-293f1e45dbefd4492a52f68b76430af4.png" width="964" height="796" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="gestion-des-interruptions">Gestion des interruptions.<a class="hash-link" href="#gestion-des-interruptions" title="Lien direct vers la rubrique">​</a></h2><p>Les périphériques d&#x27;E/S/OI, tels que les adaptateurs réseau, les contrôleurs de disque et les puces de minuterie, déclenchent une interruption en signalant une broche sur la puce du processeur et en plaçant un numéro d&#x27;exception sur le bus système qui identifie le périphérique à l&#x27;origine de l&#x27;interruption.</p><p><img loading="lazy" alt="img_13.png" src="/fr/assets/images/img_13-18afad785386bd7d289486e98768268d.png" width="964" height="406" class="img_E7b_"> Une fois l&#x27;exécution de l&#x27;instruction en cours terminée, le processeur remarque que la tension au niveau de la broche d&#x27;interruption est élevée, lit le numéro d&#x27;exception sur le bus système, puis appelle le gestionnaire d&#x27;interruption approprié. Lorsque le gestionnaire revient, il rend le contrôle à l&#x27;instruction suivante (c&#x27;est-à-dire celle qui aurait suivi l&#x27;instruction en cours dans le flux de contrôle si l&#x27;interruption ne s&#x27;était pas produite). Le résultat est que le programme continue de s&#x27;exécuter comme si l&#x27;interruption ne s&#x27;était pas produite.</p><p>Les types d&#x27;exception restants (déroutement, erreur et terminaison) se produisent de manière synchrone et résultent de l&#x27;exécution de l&#x27;instruction en cours. Nous appelons ce type d&#x27;instruction une instruction fautive.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="manipulation-des-pièges">Manipulation des pièges.<a class="hash-link" href="#manipulation-des-pièges" title="Lien direct vers la rubrique">​</a></h2><p>Les interruptions sont des exceptions intentionnelles résultant de l&#x27;exécution d&#x27;une instruction. Tout comme les gestionnaires d&#x27;interruptions, les gestionnaires d&#x27;interruptions rendent le contrôle à l&#x27;instruction suivante. L&#x27;utilisation la plus importante des interruptions consiste à fournir une interface de type procédure entre le programme utilisateur et le noyau, appelée appel système. Les programmes utilisateur ont souvent besoin de demander des services au noyau, tels que la lecture d&#x27;un fichier (read), la création d&#x27;un nouveau processus (fork), le chargement d&#x27;un nouveau programme (execve) ou l&#x27;arrêt du processus en cours (exit). Pour permettre un accès contrôlé à ces services du noyau, le processeur fournit une instruction spéciale &quot;syscall n&quot; qui peut être exécutée lorsqu&#x27;un programme utilisateur souhaite demander le service n. L&#x27;exécution de l&#x27;instruction syscall entraîne une interruption vers un gestionnaire d&#x27;exceptions qui résout les arguments et appelle le programme de noyau approprié.</p><p><img loading="lazy" alt="img_14.png" src="/fr/assets/images/img_14-66f20dc214a17879306ea7e74f4721b7.png" width="944" height="336" class="img_E7b_"> Du point de vue d&#x27;un programmeur, les appels système et les appels de fonction normaux sont les mêmes. Cependant, ils sont mis en œuvre très différemment. Les fonctions ordinaires s&#x27;exécutent en mode utilisateur, ce qui limite les types d&#x27;instructions qu&#x27;une fonction peut exécuter, et elles ne peuvent accéder qu&#x27;à la même pile que la fonction appelante. Les appels système s&#x27;exécutent en mode noyau, ce qui permet aux appels système d&#x27;exécuter des instructions privilégiées et d&#x27;accéder à la pile définie dans le noyau.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="traitement-des-pannes">Traitement des pannes.<a class="hash-link" href="#traitement-des-pannes" title="Lien direct vers la rubrique">​</a></h2><p>L&#x27;erreur est causée par une condition d&#x27;erreur, qui peut être corrigée par le gestionnaire d&#x27;erreurs. Lorsqu&#x27;un défaut se produit, le processeur transfère le contrôle au gestionnaire de défauts. Si le gestionnaire est capable de corriger la condition d&#x27;erreur, il rend le contrôle à l&#x27;instruction qui a provoqué l&#x27;erreur et la réexécute ainsi. Sinon, le gestionnaire retourne à la routine d&#x27;abandon dans le noyau, et la routine d&#x27;abandon met fin à l&#x27;application qui a causé l&#x27;erreur. <img loading="lazy" alt="img_15.png" src="/fr/assets/images/img_15-eb87aac9eabd1852657d1106ded68be2.png" width="970" height="326" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="abandonner-la-manipulation">Abandonner la manipulation.<a class="hash-link" href="#abandonner-la-manipulation" title="Lien direct vers la rubrique">​</a></h2><p>L&#x27;arrêt est le résultat d&#x27;une erreur fatale irrécupérable, généralement une erreur matérielle telle qu&#x27;une erreur de parité qui se produit lorsqu&#x27;un bit DRAM ou SRAM est corrompu. Le gestionnaire de terminaison ne rend jamais le contrôle à l&#x27;application. <img loading="lazy" alt="img_16.png" src="/fr/assets/images/img_16-0fa205ab6ed1df8ff13ffd36d3ac28fa.png" width="1010" height="324" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="exceptions-linuxx86-64-dans-le-système">Exceptions Linux/x86-64 dans le système<a class="hash-link" href="#exceptions-linuxx86-64-dans-le-système" title="Lien direct vers la rubrique">​</a></h3><p>Les nombres 0 ∼ 31 correspondent à des exceptions définies par les architectes d&#x27;Intel et sont donc les mêmes pour tout système x86-64. 32 ∼ 255 correspondent aux interruptions et traps définis par le système d&#x27;exploitation.</p><table><thead><tr><th align="left">Numéro d&#x27;exception</th><th align="left">La description</th><th align="left">Classe Exozone</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">erreur de division</td><td align="left">faute</td></tr><tr><td align="left">13</td><td align="left">Défaut de protection générale</td><td align="left">Faute</td></tr><tr><td align="left">14</td><td align="left">Page manquante</td><td align="left">faute</td></tr><tr><td align="left">18</td><td align="left">Vérification des machines</td><td align="left">Avorter</td></tr><tr><td align="left">32 ~ 255</td><td align="left">Exceptions définies par le système d&#x27;exploitation</td><td align="left">Interruptions ou pièges</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="échecs-et-arrêts-linuxx86-64">Échecs et arrêts Linux/x86-64<a class="hash-link" href="#échecs-et-arrêts-linuxx86-64" title="Lien direct vers la rubrique">​</a></h3><p>Erreur de division (exception 0). Une tentative de division par zéro a donné un résultat trop grand pour l&#x27;opérande cible. Exception virgule flottante (Floating exception) Défaut de protection générale (Exception 13). Une zone indéfinie de mémoire virtuelle a été référencée ou parce que le programme a tenté d&#x27;écrire un segment de texte en lecture seule. &quot;Défaut de segmentation (Défaut de segmentation)&quot; Page manquante (Exception 14). Will re-execute Le gestionnaire mappe une page de mémoire virtuelle sur le disque approprié vers une page de mémoire physique, puis réexécute cette instruction qui a généré l&#x27;erreur. Machine check (Exception 18) Se produit lorsqu&#x27;une erreur matérielle fatale est détectée. Ne rend jamais le contrôle à l&#x27;application.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="appels-système-linuxx86-64">Appels système Linux/x86-64<a class="hash-link" href="#appels-système-linuxx86-64" title="Lien direct vers la rubrique">​</a></h3><p>Linux Linux fournit des centaines d&#x27;appels système qui peuvent être utilisés lorsqu&#x27;une application souhaite demander un service du noyau, y compris la lecture d&#x27;un fichier, l&#x27;écriture d&#x27;un fichier ou la création d&#x27;un nouveau processus.</p><table><thead><tr><th align="right">numéro</th><th align="center">Nom</th><th align="center">la description</th><th align="center">numéro</th><th align="center">Nom</th><th align="left">la description</th></tr></thead><tbody><tr><td align="right">0</td><td align="center">lire</td><td align="center">lire le dossier</td><td align="center">33</td><td align="center">pause</td><td align="left">suspendre le processus jusqu&#x27;à ce que le signal arrive</td></tr><tr><td align="right">1</td><td align="center">écrivez</td><td align="center">écrire le fichier</td><td align="center">37</td><td align="center">alarme</td><td align="left">planifier la transmission du signal d&#x27;alarme</td></tr><tr><td align="right">2</td><td align="center">ouvrir</td><td align="center">ouvrir le fichier</td><td align="center">39</td><td align="center">getpid</td><td align="left">obtenir l&#x27;ID du processus</td></tr><tr><td align="right">3</td><td align="center">Fermer</td><td align="center">fermer le dossier</td><td align="center">57</td><td align="center">fourchette</td><td align="left">créer le processus</td></tr><tr><td align="right">4</td><td align="center">statistique</td><td align="center">Obtenir des informations sur le fichier</td><td align="center">59</td><td align="center">exécuter</td><td align="left">Exécuter un programme</td></tr><tr><td align="right">9</td><td align="center">mmap</td><td align="center">mapper des pages de mémoire à un fichier</td><td align="center">60</td><td align="center">sortir</td><td align="left">terminer un processus</td></tr><tr><td align="right">12</td><td align="center">brk</td><td align="center">réinitialiser le haut du tas</td><td align="center">61</td><td align="center">attendre4</td><td align="left">attendre qu&#x27;un processus se termine</td></tr><tr><td align="right">32</td><td align="center">dup2</td><td align="center">Copier un descripteur de fichier</td><td align="center">62</td><td align="center">tuer</td><td align="left">Envoyer un signal à un processus</td></tr></tbody></table><p>Les programmes C peuvent appeler n&#x27;importe quel appel système directement avec la fonction syscall.</p><p>Sur IA32, l&#x27;appel système Linux est appelé sys_call() via l&#x27;interruption int 0x80, qui accède à la table des vecteurs d&#x27;interruption. Il transmet le numéro d&#x27;appel système via eax ; une série d&#x27;autres registres transmettent les paramètres, stockés dans ebx, ecx, edx, esi, edi, ebp ; et la valeur de retour est stockée dans eax. L&#x27;architecture x86 64 introduit une instruction spéciale, syscall, qui n&#x27;accède pas à la table des descripteurs d&#x27;interruption et est beaucoup plus rapide. Il transmet le numéro d&#x27;appel système via rax ; une série d&#x27;autres registres transmettent les paramètres (6), stockés dans rdi, rsi, rdx, r10, r8, r9 ; la valeur de retour est stockée dans rax.</p><div class="language-shell codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-shell codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#include &lt;unistd_32.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int </span><span class="token function-name function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;bonjour, monde</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-as codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-as codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">.section .data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chaîne :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .ascii &quot;hello, world\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string_end :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .equ len, string_end - chaîne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.globl main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , world\n&quot;, 13)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $1, %rax # write est l&#x27;appel système 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $1, %rdi # Arg1 : stdout a le descripteur 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $string, %rsi # Arg2 : hello world string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $len, %rdx # Arg3 : longueur de la chaîne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syscall # Effectuez l&#x27;appel système</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Ensuite, appelez _exit(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $60, %rax # _exit est l&#x27;appel système 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  movq $0, %rdi # Arg1 : l&#x27;état de sortie est 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syscall # Make l&#x27;appel système</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copier le code dans le presse-papiers" title="Copie" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Un processus fournit à chaque programme son propre espace d&#x27;adressage privé.</strong></p><p><img loading="lazy" alt="img_17.png" src="/fr/assets/images/img_17-3b89551411862ef4cd85ef912501cf87.png" width="922" height="882" class="img_E7b_"> La partie inférieure de l&#x27;espace d&#x27;adressage est réservée au programme utilisateur, avec les segments habituels de code, de données, de tas et de pile. Le segment de code commence toujours à l&#x27;adresse 0x400000. La partie supérieure de l&#x27;espace d&#x27;adressage est réservée au noyau (la partie résidente en mémoire du système d&#x27;exploitation). Cette partie de l&#x27;espace d&#x27;adressage contient le code, les données et la pile que le noyau utilise lorsqu&#x27;il exécute les instructions pour le compte du processus (par exemple, lorsque le programme d&#x27;application exécute un appel système ).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="fourchette">Fourchette<a class="hash-link" href="#fourchette" title="Lien direct vers la rubrique">​</a></h3><p>Appelé une fois et revenu deux fois.<br>
<!-- -->Exécution simultanée. Espace d&#x27;adressage identique mais séparé. Fichiers partagés. <img loading="lazy" alt="img_18.png" src="/fr/assets/images/img_18-c3004995acf19ac52ee25577e6bc0d99.png" width="941" height="325" class="img_E7b_"></p><p>Si un processus parent se termine, le noyau s&#x27;arrange pour que le processus init devienne le parent adoptif de ses processus orphelins. init a un PID de 1, est créé par le noyau au démarrage du système, ne se termine pas et est l&#x27;ancêtre de tous les processus. Si le processus parent se termine sans récupérer ses enfants morts, le noyau planifiera le processus init pour les récupérer. Cependant, les programmes de longue durée, tels que les shells ou les serveurs, doivent toujours recycler leurs enfants morts. Même si les processus enfants morts ne sont pas en cours d&#x27;exécution, ils consomment toujours des ressources de mémoire système.</p><p>Un processus peut attendre que ses processus enfants se terminent ou s&#x27;arrêtent en appelant la fonction waitpid.</p><p>La fonction waitpid est un peu compliquée. Par défaut (lorsque options=0), waitpid suspend l&#x27;exécution du processus appelant jusqu&#x27;à ce que l&#x27;un de ses processus enfants dans le jeu d&#x27;attente se termine. Si l&#x27;un des processus du jeu d&#x27;attente s&#x27;est terminé au moment de l&#x27;appel, alors waitpid revient immédiatement. Dans les deux cas, waitpid renvoie le PID du processus enfant terminé qui a provoqué le retour de waitpid. à ce stade, le processus enfant terminé a été récupéré et le noyau en supprime toute trace du système.</p><p>L&#x27;appartenance à la collection d&#x27;attente est déterminée par le paramètre pid.</p><ul><li>Si Pid&gt;0, alors la collection d&#x27;attente est un processus enfant unique avec un ID de processus égal à pid.</li><li>Si Pid=-1, alors la collection d&#x27;attente est composée de tous les enfants du processus parent.</li></ul><p>La variable argv pointe vers un tableau de pointeurs se terminant par null, chacun pointant vers une chaîne d&#x27;arguments. Par convention, argv<!-- -->[0]<!-- --> est le nom du fichier cible exécutable.</p><p><img loading="lazy" alt="img_21.png" src="/fr/assets/images/img_21-05b28cdf75bce2df17eadcd5b1aa2b12.png" width="1146" height="740" class="img_E7b_"> La variable envp pointe vers un tableau de pointeurs se terminant par null, chacun pointant vers une chaîne de variables d&#x27;environnement, chacune étant une paire nom-valeur de la forme &quot;nom=valeur&quot;.</p><p><img loading="lazy" alt="img_19.png" src="/fr/assets/images/img_19-e7f161697e246df5430dd6169a0228cb.png" width="1252" height="816" class="img_E7b_"></p><p><img loading="lazy" alt="img_22.png" src="/fr/assets/images/img_22-75dc9173287ee640b66c6560a7a95c6b.png" width="1148" height="906" class="img_E7b_"></p><p>A un instant donné, l&#x27;ensemble des pages virtuelles est divisé en trois sous-ensembles disjoints.</p><ul><li>Non alloué : pages qui n&#x27;ont pas encore été allouées (ou créées) par le système VM. Les blocs non alloués ne sont associés à aucune donnée et n&#x27;occupent donc pas d&#x27;espace disque.</li><li>En cache : pages allouées qui sont actuellement mises en cache dans la mémoire physique.</li><li>Non mis en cache : pages allouées qui ne sont pas mises en cache dans la mémoire physique.</li></ul><p>Le cache SRAM représente les caches Ll, L2 et L3 situés entre le CPU et la mémoire principale, et le cache DRAM représente la mémoire virtuelle. Cache DRAM pour représenter le cache du système de mémoire virtuelle, qui met en cache les pages virtuelles dans la mémoire principale.</p><p><img loading="lazy" alt="img_23.png" src="/fr/assets/images/img_23-49a90da73609d0273c04516dcd327695.png" width="1327" height="735" class="img_E7b_"></p><ul><li>Étape 1 : Le processeur génère une adresse virtuelle et la transmet à la MMU.</li><li>Étape 2 : La MMU génère une adresse PTE et la demande au cache/maître.</li><li>Étape 3 : Le cache/mémoire principale renvoie le PTE à la MMU.</li><li>Étape 4 : La MMU construit l&#x27;adresse physique et la transmet au cache/maître.</li><li>Étape 5 : L&#x27;antémémoire/mémoire de départ renvoie le mot de données demandé au processeur. <img loading="lazy" alt="img_24.png" src="/fr/assets/images/img_24-b4098c54b31796997de1ed444f427b4f.png" width="934" height="803" class="img_E7b_"></li><li>Étapes 1 à 3 : Idem.</li><li>Étape 4 : Le bit valide dans le PTE est zéro, donc la MMU déclenche une exception, passant le contrôle du CPU au gestionnaire d&#x27;exception hors page dans le noyau du système d&#x27;exploitation.</li><li>Étape 5 : Le gestionnaire hors page détermine la page sacrificielle dans la mémoire physique et la transfère sur le disque si la page a été modifiée.</li><li>Étape 6 : La page du gestionnaire hors page appelle la nouvelle page et met à jour le PTE en mémoire.</li><li>Étape 7 : Le gestionnaire de page manquante revient au processus d&#x27;origine et exécute à nouveau l&#x27;instruction qui a causé la page manquante. le CPU renvoie l&#x27;adresse virtuelle qui a causé la page manquante à la MMU. étant donné que la page virtuelle est maintenant mise en cache dans la mémoire physique, elle frappe et, une fois que la MMU a effectué les étapes de la figure 9-13b, la mémoire principale renvoie le mot demandé au processeur.</li></ul><p><img loading="lazy" alt="img_25.png" src="/fr/assets/images/img_25-b91f2762afcca85898a1350b9986854f.png" width="970" height="741" class="img_E7b_"></p><p>Traduction d&#x27;adresse Core i7. <img loading="lazy" alt="img_26.png" src="/fr/assets/images/img_26-d102c4ed20c54c6769f68be82735839f.png" width="1047" height="773" class="img_E7b_"></p><p>Mise en forme des entrées dans les tableaux de pages de niveau 1, niveau 2 ou niveau 3. Nécessite un alignement de 4 Ko de la table des pages physiques. <img loading="lazy" alt="img_27.png" src="/fr/assets/images/img_27-d0eb480bd01628bb868640e592d3ad59.png" width="965" height="586" class="img_E7b_"> Lorsque P=1, le champ d&#x27;adresse contient un numéro de page physique (PPN) de 40 bits, le Format des entrées dans la table des pages de quatrième niveau. Nécessite un alignement de 4 Ko de pages physiques. ! <a target="_blank" href="/fr/assets/files/img_29-88bbd4f26421bac9f1c4acedc0cab88d.png">img_29.png</a> Lorsque la MMU traduit chaque adresse virtuelle, elle met également à jour les deux autres bits qui seront utilisés par le gestionnaire de pages manquantes du noyau. Chaque fois qu&#x27;une page est accédée, la MMU définit un bit A, appelé bit de référence. Le noyau peut utiliser ce bit de référence pour implémenter son algorithme de remplacement de page. Chaque fois qu&#x27;une page est écrite, la MMU définit le bit D, également appelé bit de modification ou bit sale. Le bit de modification indique au noyau s&#x27;il doit réécrire dans la page sacrificielle avant de copier la page de remplacement. Le noyau peut effacer le bit de référence ou de modification en appelant une instruction spéciale du mode noyau.</p><p>Comment le Core i7 MMU utilise une table de pages à quatre niveaux pour traduire les adresses virtuelles en adresses physiques. <img loading="lazy" alt="img_28.png" src="/fr/assets/images/img_28-cf66700a7b2d28896cefa1b1cd5ae0d3.png" width="1114" height="645" class="img_E7b_"></p><p>Mémoire virtuelle pour 1 processus Linux <img loading="lazy" alt="img_30.png" src="/fr/assets/images/img_30-5ff70a02f1be3297c3ac21eca995ce51.png" width="562" height="728" class="img_E7b_"> Une zone (area) est une tranche contiguë (morceau) de mémoire virtuelle qui existe déjà (a été allouée) et ces pages sont associées d&#x27;une manière ou d&#x27;une autre. Les segments de code, les segments de données, le tas, les segments de bibliothèque partagée et les piles d&#x27;utilisateurs sont tous des domaines différents. Chaque page virtuelle qui existe est conservée dans une certaine zone, tandis que les pages virtuelles qui n&#x27;appartiennent pas à une certaine zone n&#x27;existent pas et ne peuvent pas être référencées par des processus. Le noyau maintient une structure de tâches distincte (task_struct dans le code source) pour chaque processus du système. Les éléments de la structure de tâche contiennent ou pointent vers toutes les informations dont le noyau a besoin pour exécuter le processus (par exemple, le PID, un pointeur vers la pile utilisateur, le nom du fichier cible exécutable et le compteur de programme). Une entrée dans la structure de la tâche pointe vers mm_struct, qui décrit l&#x27;état actuel de la mémoire virtuelle. Les deux champs d&#x27;intérêt sont pgd et mmap, où pgd pointe vers l&#x27;adresse de base de la table de pages de premier niveau (répertoire global de pages), et mmap pointe vers une chaîne de vm_area_structs (structures de zone), où chaque vm_area_struct décrit une zone de l&#x27;espace d&#x27;adressage virtuel actuel. Lorsque le noyau exécute ce processus, il stocke le pgd dans le registre de contrôle CR3. \ vm_start : pointe vers le début de cette zone. \ vm_end : pointe vers la fin de cette région. \ vm_prot : décrit les autorisations de lecture et d&#x27;écriture pour toutes les pages contenues dans cette région. \ vm_flags : décrit si les pages de cette région sont partagées avec d&#x27;autres processus ou sont privées pour ce processus (décrit également d&#x27;autres informations). \ vm_next : pointe vers la structure de région suivante dans la chaîne. \ <img loading="lazy" alt="img_31.png" src="/fr/assets/images/img_31-20645c7ae6e5a6d6b7a93bbf9b83a900.png" width="952" height="663" class="img_E7b_"></p><p><img loading="lazy" alt="img_32.png" src="/fr/assets/images/img_32-d20b74dd11209a8e4dadf52bfb33b58a.png" width="785" height="597" class="img_E7b_"></p><p>Le chargement et l&#x27;exécution de a.out nécessitent les étapes suivantes. 1.<strong>Supprimer la zone utilisateur déjà existante.</strong>Supprimez la structure de région existante dans la partie utilisateur de l&#x27;adresse virtuelle du processus actuel. 2.<strong>Cartographier les zones privées.</strong>Créez de nouvelles structures de zone pour les zones de code, de données, de bss et de pile du nouveau programme. Toutes ces nouvelles zones sont privées, en copie sur écriture. Les zones de code et de données sont mappées sur les zones .text et .stack du fichier a.out. texte et. La zone bss est demandée pour les zéros binaires et est mappée sur un fichier anonyme dont la taille est contenue dans a.out. Les régions de pile et de tas demandent également des zéros binaires et ont une longueur initiale de zéro. La figure 9-31 résume les différents mappages de régions privées. 3. 3.<strong>Cartographie des zones partagées.</strong>Si le programme a.out est lié à un objet partagé (ou cible), comme la bibliothèque C standard libc.so, alors ces objets sont dynamiquement liés à ce programme puis mappés dans une zone partagée dans l&#x27;espace d&#x27;adressage virtuel de l&#x27;utilisateur . 4.<strong>Réglez le compteur de programme (PC). La dernière chose que fait</strong>execve est de définir le compteur de programme dans le contexte du processus en cours pour qu&#x27;il pointe vers le point d&#x27;entrée de la zone de code.</p><p> <img loading="lazy" alt="img_33.png" src="/fr/assets/images/img_33-391303c425b206adff0429f2fe6d4c3b.png" width="445" height="596" class="img_E7b_"></p><p>1.<strong>alternateur explicite</strong>, qui oblige l&#x27;application à libérer explicitement tous les blocs alloués. Par exemple, la bibliothèque standard C fournit un alternateur explicite appelé package malloc. Les opérateurs new et delete en C++ sont équivalents à malloc et free en C. 2. 2.<strong>l&#x27;allocateur implicite</strong>, d&#x27;autre part, exige que l&#x27;allocateur détecte quand un bloc alloué n&#x27;est plus utilisé par le programme, puis libère le bloc. Un alternateur implicite est également appelé<strong>ramasse-miettes</strong>, et le processus de libération automatique des blocs alloués inutilisés est appelé<strong>ramasse-miettes</strong>. Les langages de haut niveau tels que Lisp, ML et Java, par exemple, s&#x27;appuient sur la récupération de place pour libérer les blocs alloués.</p><p>La fonction malloc renvoie un pointeur vers un bloc de mémoire d&#x27;au moins taille octets, qui est aligné pour tous les types d&#x27;objets de données pouvant être contenus dans le bloc. En pratique, l&#x27;alignement dépend du fait que le code compilé s&#x27;exécute en mode 32 bits (gcc -m32) ou en mode 64 bits (valeur par défaut). En mode 32 bits, l&#x27;adresse du bloc renvoyée par malloc est toujours un multiple de 8. En mode 64 bits, l&#x27;adresse est toujours un multiple de 16. La fonction sbrk étend et réduit le tas en ajoutant incr au pointeur brk du noyau. S&#x27;il réussit, il renvoie l&#x27;ancienne valeur de brk, sinon il renvoie -1 et définit errno sur ENOMEM. sbrk renvoie la valeur actuelle de brk si incr vaut zéro. Appeler sbrk avec un incr négatif est légal et intelligent car la valeur de retour (l&#x27;ancienne valeur de brk) pointe vers abs(incr) octets à partir du haut du nouveau tas. Le programme libère le bloc de tas alloué en appelant la fonction free. <img loading="lazy" alt="img_34.png" src="/fr/assets/images/img_34-1034c631a991255000ee0d5065dcaa9a.png" width="553" height="649" class="img_E7b_"> a : Le programme demande un bloc de 4 mots. malloc répond en coupant un bloc de 4 mots à l&#x27;avant du bloc libre et en renvoyant un pointeur sur le premier mot du bloc. b : Le programme demande un bloc de 5 mots. malloc répond en allouant un bloc de 6 mots à partir de l&#x27;avant du bloc libre. Dans ce cas, malloc remplit le bloc avec un mot supplémentaire, afin de garder le bloc libre aligné sur la limite du double mot. c : Le programme demande un bloc de 6 mots et malloc coupe un bloc de 6 mots à l&#x27;avant du bloc libre. d : Le programme libère le bloc de 6 caractères attribué en b. Notez qu&#x27;après le retour de l&#x27;appel à free, le pointeur p2 pointe toujours sur le bloc libéré. Il est de la responsabilité de l&#x27;application de ne plus utiliser p2 jusqu&#x27;à ce qu&#x27;il soit réinitialisé par un nouvel appel malloc. e : Le programme demande un bloc de 2 caractères. Dans ce cas, malloc alloue une partie du bloc libéré à l&#x27;étape précédente et renvoie un pointeur vers ce nouveau bloc.</p><p>Contraintes d&#x27;allocation explicites. 1.<strong>Gérer des séquences arbitraires de requêtes.</strong> Une application peut avoir une séquence arbitraire de demandes d&#x27;allocation et de libération, tant que la contrainte est satisfaite : chaque demande de libération doit correspondre à un bloc actuellement alloué qui a été obtenu à partir d&#x27;une demande d&#x27;allocation précédente. Ainsi, l&#x27;allocateur ne peut pas supposer une séquence de demandes d&#x27;allocation et de libération. Par exemple, l&#x27;allocateur ne peut pas supposer que toutes les demandes d&#x27;allocation ont des demandes de libération correspondantes, ou qu&#x27;il existe des demandes d&#x27;allocation et de libération correspondantes qui sont imbriquées. 2.<strong>Réponse immédiate aux demandes.</strong> Les allocataires doivent répondre immédiatement aux demandes d&#x27;allocation. Par conséquent, l&#x27;allocateur n&#x27;est pas autorisé à réorganiser ou mettre en mémoire tampon les demandes pour améliorer les performances. 3.<strong>Utilisez uniquement le tas.</strong>Pour que l&#x27;allocateur soit évolutif, toutes les structures de données non scalaires utilisées par l&#x27;allocateur doivent être stockées dans le tas. 4.<strong>Aligner les blocs (exigences d&#x27;alignement).</strong>Les répartiteurs doivent aligner les blocs afin qu&#x27;ils puissent contenir n&#x27;importe quel type d&#x27;objet de données. 5.<strong>Ne modifiez pas les blocs alloués.</strong>Les allocators ne peuvent manipuler ou modifier que des blocs libres. En particulier, une fois qu&#x27;un bloc a été alloué, il ne peut plus être modifié ou déplacé. Par conséquent, les techniques telles que la compression des blocs alloués ne sont pas autorisées.</p><p><img loading="lazy" alt="img_35.png" src="/fr/assets/images/img_35-3394a44b4a0f939965192b20f8aef179.png" width="837" height="332" class="img_E7b_">Le format d&#x27;un bloc de tas simple Si nous imposons une contrainte d&#x27;alignement de mots doubles, alors la taille du bloc est toujours un multiple de 8 et les 3 bits les plus bas de la taille du bloc sont toujours nuls. Par conséquent, nous n&#x27;avons besoin que des 29 bits de poids fort de la taille de la mémoire et libérons les 3 bits restants pour encoder d&#x27;autres informations. Dans ce cas, nous utilisons le bit le plus bas (le bit alloué) pour indiquer si le bloc est alloué ou libre. Par exemple, supposons que nous ayons un bloc alloué d&#x27;une taille de 24 (0x18) octets. Ensuite, son en-tête sera</p><p><strong>0x00000018 | 0x1 = 0x00000019</strong></p><p>De même, un bloc libre avec une taille de bloc de 40 (0x28) octets a l&#x27;en-tête suivant.</p><p><strong>0x00000028 | 0x0 = 0x00000028</strong></p><p>Après l&#x27;en-tête se trouve la charge utile demandée par l&#x27;application lorsque malloc est appelé. La charge utile est suivie d&#x27;un morceau de remplissage inutilisé, qui peut être de taille arbitraire. Le rembourrage est nécessaire pour un certain nombre de raisons. Par exemple, le remplissage peut faire partie d&#x27;une stratégie d&#x27;allocation pour faire face à la fragmentation externe. Ou il peut également être nécessaire pour répondre aux exigences d&#x27;alignement.</p><p><img loading="lazy" alt="img_36.png" src="/fr/assets/images/img_36-1a6fbc79a2945ec93bd879e2a377fa1d.png" width="1104" height="160" class="img_E7b_"> Organisez le tas avec une table de liens libres implicites. Les parties ombrées sont des blocs alloués. La partie non ombrée est le bloc libre. L&#x27;en-tête est marqué (taille en octets / bits alloués) puis la taille de chaque bloc doit être un multiple d&#x27;un mot double (8 octets). Ainsi, il en résulte une taille de bloc minimale de deux mots : un mot pour l&#x27;en-tête et un autre mot pour maintenir les exigences d&#x27;alignement. Même si l&#x27;application ne demande qu&#x27;un seul octet, l&#x27;allocateur doit toujours créer un bloc de deux mots. L&#x27;avantage d&#x27;une table de liens libres implicites est sa simplicité. L&#x27;inconvénient majeur est que la surcharge de toute opération, telle que le placement d&#x27;un bloc alloué, nécessite une recherche dans la table de chaîne inactive, et le temps requis pour cette recherche est linéairement lié au nombre total de blocs alloués et inactifs dans le tas.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Malaaaa/blog-sample/tree/main/docs/CSAPP/Exceptional Control Flow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Modifier cette page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navigation dans les pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/fr/docs/CSAPP/CSAPPNOTE"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Systèmes informatiques</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fr/docs/CSAPP/I/O"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">O</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#gestion-des-interruptions" class="table-of-contents__link toc-highlight">Gestion des interruptions.</a></li><li><a href="#manipulation-des-pièges" class="table-of-contents__link toc-highlight">Manipulation des pièges.</a></li><li><a href="#traitement-des-pannes" class="table-of-contents__link toc-highlight">Traitement des pannes.</a></li><li><a href="#abandonner-la-manipulation" class="table-of-contents__link toc-highlight">Abandonner la manipulation.</a><ul><li><a href="#exceptions-linuxx86-64-dans-le-système" class="table-of-contents__link toc-highlight">Exceptions Linux/x86-64 dans le système</a></li><li><a href="#échecs-et-arrêts-linuxx86-64" class="table-of-contents__link toc-highlight">Échecs et arrêts Linux/x86-64</a></li><li><a href="#appels-système-linuxx86-64" class="table-of-contents__link toc-highlight">Appels système Linux/x86-64</a></li><li><a href="#fourchette" class="table-of-contents__link toc-highlight">Fourchette</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Malaaaa Site. Construit avec Docusaurus.</div></div></div></footer></div>
<script src="/fr/assets/js/runtime~main.141affde.js"></script>
<script src="/fr/assets/js/main.f9e7bdf0.js"></script>
</body>
</html>